<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ê°€ê²Œ ì£¼ë¬¸ ëª©ë¡</title>

    <!-- ğŸ–Œï¸ ì¹´ë“œâ€‘ìŠ¤íƒ€ì¼ ì „ìš© CSS -->
    <style>
        * { box-sizing: border-box; }
        body { font-family: system-ui, sans-serif; margin: 0; padding: 0 1.5rem; }
        h2 { margin-top: 1.5rem; }

        /* ìƒë‹¨ í™ˆ ë²„íŠ¼ ì˜ì—­ */
        .top-bar {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            padding: 1rem 0 0.2rem;
        }

        .home-button {
            background-color: #03c75a;
            color: white;
            font-weight: bold;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 0.9rem;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: background-color 0.2s ease;
            text-decoration: none;
        }

        .home-button:hover {
            background-color: #029e47;
        }

        .filter {
            margin-top: 1rem;
        }
        select, button {
            padding: 4px 8px;
            font-size: 0.95rem;
            margin-right: 4px;
        }

        .order-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1.25rem;
        }

        .order-card {
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 1rem 1.25rem;
            background-color: #ffffff;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .order-id {
            font-weight: 600;
            font-size: 1.05rem;
        }

        .status-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            color: #fff;
        }

        .WAITING { background: #9e9e9e; }
        .ACCEPTED { background: #1976d2; }
        .COOKING { background: #ef6c00; }
        .DELIVERY_READY { background: #00796b; }
        .COMPLETED { background: #4caf50; }
        .CANCELED { background: #d32f2f; }

        .order-section { margin: 0.3rem 0; }
        .order-section strong { display: inline-block; width: 5.5rem; }

        .menu-list {
            margin: 0.3rem 0 0.5rem 0;
            padding-left: 1rem;
        }

        .menu-list li {
            list-style: disc;
            margin: 2px 0;
        }

        .empty {
            text-align: center;
            color: #757575;
            margin-top: 2rem;
        }
    </style>
</head>
<body>
<div class="container">
    <!-- ğŸ  í™ˆ ë²„íŠ¼ -->
    <div class="top-bar">
        <a href="/customer/home" class="home-button">ğŸ  í™ˆìœ¼ë¡œ</a>
    </div>

    <h2>ë‚´ ì£¼ë¬¸ ë‚´ì—­</h2>

    <div class="filter">
        <label for="orderStatus">ì£¼ë¬¸ ìƒíƒœ:</label>
        <select id="orderStatus">
            <option value="">ì „ì²´</option>
            <option value="WAITING">ëŒ€ê¸°</option>
            <option value="ACCEPTED">ìˆ˜ë½ë¨</option>
            <option value="DELIVERY_READY">ë°°ë‹¬ ì¤€ë¹„</option>
            <option value="COMPLETED">ì™„ë£Œ</option>
            <option value="CANCEL">ì·¨ì†Œë¨</option>
        </select>
        <button id="filterBtn">ì¡°íšŒ</button>
    </div>

    <div id="orderList" class="order-list"></div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const orderStatusSelect = document.getElementById("orderStatus");
        const filterBtn          = document.getElementById("filterBtn");
        const orderList          = document.getElementById("orderList");

        function renderOrders(orders) {
            orderList.innerHTML = "";

            if (!orders.length) {
                orderList.innerHTML = '<p class="empty">ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            orders.forEach(order => {
                const address = order.address ?
                    `${order.address.city} ${order.address.street} ${order.address.zipcode}` : '-';

                const menusHtml = order.orderMenus.map(menu =>
                    `<li>${menu.menuName} Ã— ${menu.count}</li>`
                ).join('');

                const card = `
                    <div class="order-card">
                        <div class="order-header">
                            <div class="order-id">#${order.orderId}</div>
                            <span class="status-badge ${order.orderStatus}">${order.orderStatus}</span>
                        </div>
                        <div class="order-section"><strong>ê³ ê°ëª…:</strong> ${order.customerName || '-'}</div>
                        <div class="order-section"><strong>ì£¼ì†Œ:</strong> ${address}</div>
                        <div class="order-section"><strong>ë©”ë‰´:</strong></div>
                        <ul class="menu-list">${menusHtml}</ul>
                        <div class="order-section"><strong>ë°°ë‹¬ ìƒíƒœ:</strong> ${order.deliveryStatus}</div>
                        <div class="order-section"><strong>ì´ ê¸ˆì•¡:</strong> ${order.totalPrice.toLocaleString()}ì›</div>
                    </div>
                `;

                orderList.insertAdjacentHTML("beforeend", card);
            });
        }

        function fetchOrders() {
            const status = orderStatusSelect.value;
            let url = `/api/orders/me`;
            if (status) {
                url += `?orderStatus=${status}`;
            }

            fetch(url)
                .then(res => res.json())
                .then(json => renderOrders(json.data))
                .catch(err => {
                    console.error("ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨", err);
                });
        }

        filterBtn.addEventListener("click", fetchOrders);
        fetchOrders();
    });
</script>
</body>
</html>
